<!-- Toolbar -->
<nv-grid-toolbar
  *ngIf="gridConfig && !gridConfig.hideToolbar"
  [gridConfig]="gridConfig"
  (refresh)="refreshGrid()"
  (modifiedRowsOnSave)="savedRowsChanges()"
  (gridConfigChangedOnSave)="savedGridConfigChanges()"
  (gridConfigChangedOnReset)="resetedGridConfigChanges()"
  (createNewRow)="createNewRowAndFocusFirstCell()"
  (export)="downloadAsExcel()"
>
</nv-grid-toolbar>
<div
  #gridWrapper
  class="grid-wrapper"
>
  <!-- Header row -->
  <nv-grid-header
    [gridConfig]="gridConfig"
    [columns]="configurationService.visibleColumns$ | async"
    [selectedRowsLength]="(selectedRowsSubject | async).length"
    (columnSorted)="sortBy($event)"
    (openedContextMenu)="openContextMenu($event.colIndex, $event.rowIndex, $event.mouseEvent, $event.buttons, gridContextMenuTemplate, true)"
  >
  </nv-grid-header>
  <!-- Filter row -->
  <nv-grid-filter
    *ngIf="gridConfig && !gridConfig.hideAllFilters"
    [gridConfig]="gridConfig"
    [columns]="configurationService.visibleColumns$ | async"
    [selectedRowsLength]="(selectedRowsSubject | async).length"
    [areAllRowsSelected]="(selectedRowsSubject | async).length === rows?.length"
    (allRowsSelected)="toggleSelectAll($event)"
    (allRowsCollapsed)="collapseAllRows()"
    (gridFiltered)="filterGrid()"
  >
  </nv-grid-filter>
  <!-- Body -->
  <nv-grid-body
    *ngIf="gridConfig"
    [isLoading]="(gridDataService.isLoading$ | async) || (isLoading | async)"
    [rows]="rows | paging : gridConfig.paging : !!this.gridConfig.url"
    [gridConfig]="gridConfig"
    [selectedRows]="selectedRowsSubject | async"
    [columns]="configurationService.visibleColumns$ | async"
    [forms]="formsDataSubject | async"
    [modifiedRowsSubject]="modifiedRowsSubject"
    [focusedCellRowIndex]="(focusedCellSubject | async).rowIndex"
    [focusedCellColumnKey]="(focusedCellSubject | async).columnKey"
    [editingCellRowIndex]="(editingCellSubject | async).rowIndex"
    [editingCellColumnKey]="(editingCellSubject | async).columnKey"
    [stillClickedInsideBodySubject]="stillClickedInsideBodySubject"
    [rootConfigChanged]="nvGridI18nService.configuration$ | async"
    (selectedRow)="toggleRowSelect($event.rowIndex, $event.mouseEvent)"
    (expandedComponent)="toggleRowExpansion($event.rowIndex)"
    (openedContextMenu)="openContextMenu($event.row, $event.rowIndex, $event.mouseEvent, $event.buttons, gridContextMenuTemplate)"
    (handleCustom)="handleCustomCellClickFn($event.row, $event.column)"
    (rowClicked)="handleClickFn($event.rowIndex, $event.row, $event.mouseEvent, $event.column)"
    (handleDoubleClick)="handleDoubleClickFn($event.rowIndex, $event.row, $event.mouseEvent, $event.column)"
    (handleEnterKeyDown)="handleEnterKeyDownkFn()"
    [columnTemplates]="columnTemplates"
    [columnEditTemplates]="columnEditTemplates"
    (modifiedRowOnSave)="savedRowsChanges($event)"
    (modifiedRowOnDiscard)="unsubscribeToFormValues($event.rowId)"
    (createNewForm)="createNewForm($event.rowId)"
    (createNewRow)="createNewRowAndFocusFirstCell()"
    (jumpToFirstInvalidCell)="jumpToFirstInvalidCell()"
    (focusCell)="focusCell($event)"
    (editCell)="editCell($event)"
  >
  </nv-grid-body>
  <!-- Footer row -->
  <nv-grid-footer
    *ngIf="gridConfig && rows?.length > 0"
    [gridConfig]="gridConfig"
    [changesDetected]="footerChangesDetected | async"
    [columns]="configurationService.visibleColumns$ | async"
    [rootConfigChanged]="nvGridI18nService.configuration$ | async"
    [rows]="rows"
  >
  </nv-grid-footer>
</div>
<!-- Pagination -->
<nv-grid-pagination
  *ngIf="gridConfig && gridConfig.showPaging"
  [totalItems]="totalItems"
  [paging]="gridConfig.paging"
  [backgroundColor]="gridConfig.styles.paginationBackgroundColor"
  [showQuickJumber]="gridConfig.paging.showQuickJumper"
  [showTotalItems]="gridConfig.paging.showTotalItems"
  (pageChanged)="changePage($event)"
  (pageSizeChanged)="changePageSize($event)"
>
</nv-grid-pagination>
<!-- Context Menu -->
<nz-dropdown-menu #gridContextMenuTemplate="nzDropdownMenu">
  <ul nz-menu>
    <ng-container *ngFor="let button of contextMenuButtons;">
      <li
        *ngIf="gridUtilsService.isButtonVisible(activeRow, button)"
        nz-menu-item
        class="contextmenu-row"
      >
        <button
          class="button-container"
          nz-button
          [disabled]="gridUtilsService.isButtonDisabled(activeRow, button)"
          (click)="contextMenuButtonClicked(activeRow, button, activeRowIndex)"
        >
          <i
            nz-icon
            [nzType]="button.icon"
          >
          </i>
          {{ button.description | translate }}
        </button>
      </li>
    </ng-container>
  </ul>
</nz-dropdown-menu>
